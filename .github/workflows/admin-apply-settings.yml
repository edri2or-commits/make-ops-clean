name: admin-apply-settings
on:
  workflow_dispatch:
    inputs:
      do_security:
        description: 'Enable Secret Scanning + Push Protection + Validity + Alerts + Auto-fixes'\n        default: 'true'
      do_merges:
        description: 'Set squash-only & delete-branch-on-merge'\n        default: 'true'\npermissions:\n  contents: read\n  administration: write\n  security-events: write\nenv:\n  OWNER: ${ github.repository_owner }\n  REPO:  {{ github.event.repository.name }}\n  GH_TOKEN: ${{ github.token }}\njobs:\n  apply:\n    runs-on: ubuntu-atest\n    steps:\n      - name: Repo settings (squash-only + delete-branch-on-merge)\n        if: ${ $inputs.do_merges == 'true' }\n        run: |\n          cat > payload.json <<'JSON'\n          { "allow_merge_commit": false, "allow_rebase_merge": false, "allow_squash_merge": true, "delete_branch_on_merge": true, "squash_merge_commit_title": "PR_TITLE" }\n          JSON\n          gh api -X PATCH \\\n            -H "Accept: application/vnd.github+json" \\\n            repos/${OWNER}/${REPO} \\\n            --input payload.json\n      - name: Enable Security & Analysis (Secrets, Push Protection, Validity, Alerts, Auto-fixes)\n        if: ${ $inputs.do_security == 'true' }\n        run: |\n          cat >sec.json <<'JSON'\n          { "security_and_analysis": {"secret_scanning": {"status":"enabled"}, "secret_scanning_push_protection": {"status":"enabled"}, "secret_scanning_validity_checks": {"status":"enabled"}, "dependabot_security_updates": {"status":"enabled"} } }\n          JSON\n          gh api -X PATCH -H \"Accept: application/vnd.github+json\" repos/${OWNER}/${REPO} --input sec.json\n          gh api -X PUT repos/${OWNER}/${REPO}/vulnerability-alerts\n          gh api -X PUT repos/${OWNER}/${REPO}/automated-security-fixes\n",