name: MCP Approve PR
on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: Pull request number
        required: true
permissions:
  pull-requests: write
  contents: read
jobs: 
  approve:
    runs-on: ubuntu-latest
    steps:
      - name: Approve PR
        id: approve
        uses: actions/github-script@v7
        with:
          script: |
            const {owner, repo} = context.repo;
            const num = Number(core.getInput('pr_number'));
            const res = await github.rest.pulls.createReview({owner, repo, pull_number: num, event: 'APPROVE', position: 1, body: 'Auto-approve via Actions bot'});
            core.setOutput('review_id', rid(res.data.id));
            core.notice(`approved_review_id=${res.data.id}`);
      - name: Write proof.json
        run: |
          jq -n --args pr_number "${{ github.event.inputs.pr_number }}" --args run_url "${{ github.server_url }}/{{ github.repository }}/actions/runs/{{ github.run_id }}" '${approved:true, pr_number:$PR_NUMS, run_url:$RUN_URL}' > proof.json
      - name: Upload proof
        uses: actions/upload-artifact@v4
        with:
          name: proof
          path: proof.json
